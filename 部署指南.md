# LINE Bot + Google Calendar 自動同步系統 - 部署指南

## 📋 系統概述

這個系統能讓您通過 LINE 傳送文字或語音訊息，自動將活動資訊同步到 Google Calendar。

**主要功能：**
- ✅ 接收 LINE 文字訊息，解析活動資訊
- ✅ 接收 LINE 語音訊息，轉換為文字後解析
- ✅ 使用 OpenAI 智能解析中文活動描述
- ✅ 自動建立 Google Calendar 事件
- ✅ 回傳確認訊息給 LINE 用戶

## 🚀 部署步驟

### 步驟 1：設定 Google Apps Script

1. **開啟** [Google Apps Script](https://script.google.com/)
2. **建立新專案**，命名為「LINE Calendar Bot」
3. **刪除** 預設的 `Code.gs` 檔案
4. **建立** 以下三個檔案：
   - `main.gs` - 主程式
   - `openai-integration.gs` - OpenAI 整合
   - `calendar-integration.gs` - Calendar 整合

5. **複製程式碼** 到對應檔案中 (檔案內容已準備好)

### 步驟 2：啟用必要的 Google API

1. 在 GAS 專案中，點選 **「服務」**
2. **加入** 以下服務：
   - Google Calendar API
   - Advanced Google Services (如需要)

### 步驟 3：部署為 Web 應用程式

1. 點選 **「部署」** → **「新增部署」**
2. **選擇類型**：Web 應用程式
3. **說明**：LINE Calendar Bot v1.0
4. **執行身分**：我
5. **存取權限**：任何人
6. 點選 **「部署」**
7. **複製** Web 應用程式 URL (這就是您的 Webhook URL)

### 步驟 4：設定 LINE Developer Console

1. **登入** [LINE Developer Console](https://developers.line.biz/console/)
2. **建立** Provider (如果還沒有)
3. **建立** Messaging API Channel
4. **在 Webhook 設定中**：
   - Webhook URL：貼上剛才複製的 GAS Web 應用程式 URL
   - 啟用「Use webhook」
   - 啟用「Webhook redelivery」
5. **在 LINE Official Account Manager 中**：
   - 關閉「Greeting messages」
   - 關閉「Auto-reply messages」
   - 開啟「Webhook」

### 步驟 5：測試設定

1. **在 GAS 中執行** `testBot()` 函數
2. **用您的 LINE 帳號** 加入 Bot 為好友
3. **傳送測試訊息**：「明天下午3點有重要會議」
4. **檢查** Google Calendar 是否成功建立事件
5. **檢查** LINE 是否收到確認回覆

## 📱 使用方式

### 文字訊息範例：
```
明天下午2點有重要會議
8/19晚上八點有X的線上講座
下週三上午10點30分要去看牙醫
9月1日下午1點30分在咖啡廳見面
```

### 語音訊息：
- 直接錄製語音說出活動安排
- 系統會自動轉換為文字並解析

### 系統回應：
- ✅ 成功：顯示已建立的事件詳細資訊
- ❌ 失敗：提示無法解析或建立失敗
- ❓ 不明確：要求提供更詳細資訊

## 🔧 進階設定

### 自訂行事曆
```javascript
// 在 calendar-integration.gs 中修改
const calendar = CalendarApp.getCalendarById('your-calendar-id@gmail.com');
```

### 調整事件持續時間
```javascript
// 在 calendar-integration.gs 中修改 (預設1小時)
const endDate = new Date(startDate.getTime() + (60 * 60 * 1000)); // 1小時
```

### 修改 OpenAI 解析提示
```javascript
// 在 openai-integration.gs 中的 parseEventWithOpenAI 函數調整 prompt
```

## 🚨 故障排除

### 常見問題：

**1. LINE 收不到回應**
- 檢查 Webhook URL 是否正確
- 檢查 GAS 部署權限設定
- 查看 GAS 執行紀錄

**2. 無法建立 Calendar 事件**
- 確認 Calendar API 已啟用
- 檢查 GAS 執行權限
- 確認日期格式正確

**3. OpenAI API 錯誤**
- 檢查 API Key 是否正確
- 確認 OpenAI 帳戶有足夠額度
- 查看 GAS 日誌錯誤訊息

**4. 語音轉文字失敗**
- 確認語音檔案格式支援
- 檢查網路連線狀況
- 嘗試使用較短的語音訊息

### 查看日誌：
1. 在 GAS 中點選 **「執行」**
2. 查看 **「執行紀錄」**
3. 檢查錯誤訊息

## 📊 使用統計與監控

### 查看使用情況：
```javascript
// 在 GAS 中新增統計功能
function getUsageStats() {
  // 查看每日建立的事件數量
  // 查看成功率等統計資訊
}
```

### 監控 API 用量：
- **OpenAI Dashboard**：查看 API 使用量
- **Google Cloud Console**：查看 Calendar API 配額

## 🔒 安全性考量

- ✅ LINE Signature 驗證已實作
- ✅ 只允許特定用戶使用 (TARGET_USER_ID)
- ✅ API Keys 儲存在 GAS 環境中
- ⚠️ 建議定期更新 API Keys
- ⚠️ 監控異常使用情況

## 💡 建議改進

1. **加入更多指令**：查詢今日/明日行程
2. **支援事件修改**：更新或刪除已建立的事件
3. **加入提醒功能**：事件前通知
4. **多用戶支援**：移除 TARGET_USER_ID 限制
5. **資料備份**：定期備份重要設定

---

🎉 **恭喜！您的 LINE Calendar Bot 已經準備就緒！**

如有問題，請檢查各步驟設定或查看故障排除章節。